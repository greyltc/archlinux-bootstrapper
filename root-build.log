set -o xtrace

TMPDIR="$1"
+TMPDIR=/tmp/genbootstrap.lJWYyd
CURDIR=$(pwd)
++pwd
+CURDIR=/home/travis/build/greyltc/archlinux-bootstrapper

echo ${TMPDIR}
+echo /tmp/genbootstrap.lJWYyd
/tmp/genbootstrap.lJWYyd

sudo mkdir -p "${TMPDIR}"/root-bind
+sudo mkdir -p /tmp/genbootstrap.lJWYyd/root-bind
sudo mount --bind "${TMPDIR}"/root "${TMPDIR}"/root-bind
+sudo mount --bind /tmp/genbootstrap.lJWYyd/root /tmp/genbootstrap.lJWYyd/root-bind

cat > "${TMPDIR}"/setup-tasks.sh << "EOF"
#!/usr/bin/env bash
set -o pipefail
set -o errexit
set -o nounset
set -o verbose
set -o xtrace

touch poop

EOF
+cat

chmod +x "${TMPDIR}"/setup-tasks.sh
+chmod +x /tmp/genbootstrap.lJWYyd/setup-tasks.sh
sudo mv "${TMPDIR}"/setup-tasks.sh "${TMPDIR}"/root-bind/usr/bin/setup-tasks.sh
+sudo mv /tmp/genbootstrap.lJWYyd/setup-tasks.sh /tmp/genbootstrap.lJWYyd/root-bind/usr/bin/setup-tasks.sh

sudo "${TMPDIR}"/root-bind/bin/arch-chroot "${TMPDIR}"/root-bind/ setup-tasks.sh
+sudo /tmp/genbootstrap.lJWYyd/root-bind/bin/arch-chroot /tmp/genbootstrap.lJWYyd/root-bind/ setup-tasks.sh
set -o xtrace

touch poop
+ touch poop

sudo rm "${TMPDIR}"/root-bind/bin/setup-tasks.sh
+sudo rm /tmp/genbootstrap.lJWYyd/root-bind/bin/setup-tasks.sh
sudo umount "${TMPDIR}"/root-bind
+sudo umount /tmp/genbootstrap.lJWYyd/root-bind

sudo sh -c "(cd ${TMPDIR}/root; bsdtar -cf - * | gzip -9 > ${TMPDIR}/root.tar.gz)"
+sudo sh -c '(cd /tmp/genbootstrap.lJWYyd/root; bsdtar -cf - * | gzip -9 > /tmp/genbootstrap.lJWYyd/root.tar.gz)'
: tar format cannot archive socket: tar format cannot archive socket: tar format cannot archive socket: tar format cannot archive socket
mv "${TMPDIR}/root.tar.gz" "${CURDIR}/root-wsl.tar.gz"
+mv /tmp/genbootstrap.lJWYyd/root.tar.gz /home/travis/build/greyltc/archlinux-bootstrapper/root-wsl.tar.gz

